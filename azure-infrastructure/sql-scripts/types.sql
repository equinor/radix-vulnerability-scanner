IF NOT EXISTS(SELECT 1 FROM sys.table_types WHERE name='VulnerabilityBulkType' AND schema_id=SCHEMA_ID('dbo'))
BEGIN
	CREATE TYPE dbo.VulnerabilityBulkType AS TABLE(
		ExternalId VARCHAR(255) PRIMARY KEY,
		PackageName VARCHAR(255) NOT NULL,
		[Version] varchar(100) NOT NULL,
		Title VARCHAR(500) NOT NULL,
		[Description] VARCHAR(MAX) NOT NULL,
		Severity VARCHAR(15) NOT NULL,
		CVSS DECIMAL(3,1) NULL,
		CVSSv3 VARCHAR(150) NULL,
		CreationTime DATETIMEOFFSET(0) NOT NULL,
		ModificationTime DATETIMEOFFSET(0) NOT NULL,
		PublicationTime DATETIMEOFFSET(0) NOT NULL,
		DisclosureTime DATETIMEOFFSET(0) NULL
	)
END

GRANT EXEC ON TYPE::dbo.VulnerabilityBulkType to radixwriter
GRANT EXEC ON TYPE::dbo.VulnerabilityBulkType to radixreader

go

IF NOT EXISTS(SELECT 1 FROM sys.table_types WHERE name='VulnerabilityIdentifiersBulkType' AND schema_id=SCHEMA_ID('dbo'))
BEGIN
	CREATE TYPE dbo.VulnerabilityIdentifiersBulkType AS TABLE(
		ExternalId VARCHAR(255) NOT NULL,
		IdentifierType CHAR(3) NOT NULL,
		Identifier varchar(50) NOT NULL
	)
END

GRANT EXEC ON TYPE::dbo.VulnerabilityIdentifiersBulkType to radixwriter
GRANT EXEC ON TYPE::dbo.VulnerabilityIdentifiersBulkType to radixreader

go

IF NOT EXISTS(SELECT 1 FROM sys.table_types WHERE name='VulnerabilityReferencesBulkType' AND schema_id=SCHEMA_ID('dbo'))
BEGIN
	CREATE TYPE dbo.VulnerabilityReferencesBulkType AS TABLE(
		ExternalId VARCHAR(255) NOT NULL,
		[Url] VARCHAR(255) NOT NULL
	)
END

GRANT EXEC ON TYPE::dbo.VulnerabilityReferencesBulkType to radixwriter
GRANT EXEC ON TYPE::dbo.VulnerabilityReferencesBulkType to radixreader