DOCKER_REGISTRY=radixdev.azurecr.io
VERSION=latest
IMAGE_NAME=$(DOCKER_REGISTRY)/radix-vulnerability-scanner:$(VERSION)

.PHONY: build
build:
	docker build -t $(IMAGE_NAME) .

.PHONY: push
push:
	az acr login -n $(DOCKER_REGISTRY)
	docker push $(IMAGE_NAME)

.PHONY: test
test:	
	go test -cover `go list ./... | grep -v 'pkg/client'`	

.PHONY: mocks
mocks:	
	mockgen -source ./pkg/db/repository.go -destination ./pkg/db/mock/repository.go -package mock
	mockgen -source ./pkg/scan/scanner.go -destination ./pkg/scan/mock/scanner.go -package mock
	mockgen -destination ./pkg/imageworker/mock/scanner.go -package mock k8s.io/client-go/util/workqueue RateLimitingInterface