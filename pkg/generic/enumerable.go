package generic

import "sort"

// Enumerable contains methods for working with slices
type Enumerable[T any] []T

// AsEnumerable converts a slice to an Enumerable object
func AsEnumerable[T any](items []T) Enumerable[T] {
	return Enumerable[T](items)
}

// OrderBy returns a sorted copy of the items
func (src Enumerable[T]) OrderBy(compare func(first, second T) bool) Enumerable[T] {
	dst := make([]T, len(src))
	copy(dst, src)
	sort.SliceStable(dst, func(i, j int) bool {
		return compare(dst[i], dst[j])
	})
	return dst
}

// Last returns the last item in the list
func (src Enumerable[T]) Last() (T, bool) {
	var dflt T
	if len(src) == 0 {
		return dflt, false
	}
	return src[len(src)-1], true
}

// Distinct returns a distinct list of objects based the value returned by keySelector
func (src Enumerable[T]) Distinct(keySelector func(item T) any) Enumerable[T] {
	keyMap := make(map[any]struct{})
	dst := make([]T, 0, len(src))

	for _, i := range src {
		key := keySelector(i)
		if _, exist := keyMap[key]; !exist {
			keyMap[key] = struct{}{}
			dst = append(dst, i)
		}
	}

	return dst
}
