package observe

import (
	"sync"
)

type (
	Observable[T any] interface {
		Attach(observer Observer[T])
		Detach(observer Observer[T])
	}

	observable[T any] struct {
		observers sync.Map
	}
)

func (o *observable[T]) Attach(observer Observer[T]) {
	o.observers.Store(observer, struct{}{})
}

func (o *observable[T]) Detach(observer Observer[T]) {
	o.observers.Delete(observer)
}

func (o *observable[T]) notify(obj T) {
	o.observers.Range(func(key, value any) bool {
		if observer, ok := key.(Observer[T]); ok {
			observer.OnNext(obj)
		}
		return true
	})
}
