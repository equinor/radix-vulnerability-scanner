package observe

import (
	"context"

	"github.com/robfig/cron/v3"
)

func NewCron[T any](ctx context.Context, cronSpec string, notifyValueFunc func() T) Subject[T] {
	s := &subject[T]{}
	c := cron.New()
	c.Start()
	c.AddFunc(cronSpec, func() {
		s.NotifyObservers(notifyValueFunc())
	})
	go func() {
		<-ctx.Done()
		c.Stop()
	}()

	return s
}
