package observe

import (
	v1 "github.com/equinor/radix-operator/pkg/apis/radix/v1"
)

var _ SubjectObserver[*v1.RadixDeployment, string] = &RadixDeploymentContainerImageMapper{}

type (
	RadixDeploymentContainerImageMapper struct {
		subject[string]
		Observer[*v1.RadixDeployment]
	}
)

func (m *RadixDeploymentContainerImageMapper) OnNext(rd *v1.RadixDeployment) {
	if rd == nil {
		return
	}

	for _, c := range rd.Spec.Components {
		m.Notify(c.GetImage())
	}

	for _, c := range rd.Spec.Jobs {
		m.Notify(c.GetImage())
	}
}
